# SNSシステム総合デモ

このデモは、SNSシステムの主要機能を実際に動作する形で体験できるインタラクティブなプログラムです。DDD（Domain Driven Design）アーキテクチャに基づいて実装されており、UserQueryService、UserCommandService、PostQueryServiceなどのアプリケーションサービスが実際にどのように動作するかを確認できます。

## 概要

デモでは、サンプルデータの中の一人のユーザーとしてログインしている状態をシミュレーションし、以下の機能を試すことができます：

- **プロフィール管理**: 自分のプロフィール確認、他のユーザーのプロフィール閲覧
- **ユーザー関係管理**: フォロー、ブロック、購読などの関係性管理
- **ポスト表示・管理**: タイムライン表示、個別ポスト表示、ポスト作成・編集
- **リプライ表示・管理**: リプライの表示、作成、編集、ツリー構造表示

## 機能一覧

### 【プロフィール確認機能 (UserQueryService)】
- 自分のプロフィール表示
- 他のユーザーのプロフィール表示
- フォロー中ユーザーの一覧表示
- フォロワーの一覧表示
- ブロック中ユーザーの一覧表示
- ブロックしているユーザーの一覧表示
- 購読中ユーザーの一覧表示
- 購読者の一覧表示

### 【ユーザー管理機能 (UserCommandService)】
- 新しいユーザーを作成
- 自分のプロフィールを更新
- ユーザーをフォロー/フォロー解除
- ユーザーをブロック/ブロック解除
- ユーザーを購読/購読解除
- ログイン状態の変更

### 【ポスト表示機能 (PostQueryService)】
- 自分のタイムライン表示
- 他のユーザーのタイムライン表示
- ホームタイムライン表示（フォロー中のユーザーのポスト）
- 個別のポスト表示
- 自分のプライベートポスト表示
- 自分がいいねしたポスト一覧表示
- ハッシュタグでポストを検索
- キーワードでポストを検索
- 人気ポストの表示
- トレンドハッシュタグの表示

### 【ポスト管理機能 (PostCommandService)】
- 新しいポストを作成（公開範囲設定）
- ポストにいいね
- ポストを削除

### 【リプライ表示機能 (ReplyQueryService)】
- ポストとリプライのツリー構造を取得
- 個別のリプライを取得
- ユーザーのリプライ一覧を取得

### 【リプライ管理機能 (ReplyCommandService)】
- ポストにリプライを行う
- リプライにリプライを行う
- リプライにいいね
- リプライを削除

## 実行方法

### 準備

1. Python仮想環境を有効化してください：
   ```bash
   cd /path/to/project
   source venv/bin/activate  # Linux/Mac
   # または
   venv\Scripts\activate     # Windows
   ```

2. プロジェクトのルートディレクトリからデモを実行：
   ```bash
   python demos/sns/demo_sns_system.py
   ```

### メニュー構造

デモは階層的なメニュー構造を採用しています：

#### メインメニュー
```
📋 メインメニュー:
  1. ユーザー関係の表示・更新
  2. ポストの表示
  3. リプライの表示・管理
  0. 終了
```

#### ユーザー関係メニュー
```
📋 ユーザー関係メニュー:
  1. 自分のプロフィール表示
  2. 他のユーザーのプロフィール表示
  3. フォロー中ユーザーの一覧
  4. フォロワーの一覧
  5. ブロック中ユーザーの一覧
  6. ブロックしているユーザーの一覧
  7. 購読中ユーザーの一覧
  8. 購読者の一覧
  9. ログイン状態の変更
  A. 新しいユーザーを作成
  B. 自分のプロフィールを更新
  C. ユーザーをフォロー
  D. ユーザーのフォローを解除
  E. ユーザーをブロック
  F. ユーザーのブロックを解除
  G. ユーザーを購読
  H. ユーザーの購読を解除
  0. メインメニューに戻る
```

#### ポスト表示・管理メニュー
```
📋 ポスト表示・管理メニュー:
  1. 自分のタイムライン表示
  2. 他のユーザーのタイムライン表示
  3. ホームタイムライン表示
  4. 個別のポスト表示
  5. 自分のプライベートポスト表示
  6. 自分がいいねしたポスト一覧
  7. ハッシュタグでポストを検索
  8. キーワードでポストを検索
  9. 人気ポストを表示
 10. トレンドハッシュタグを表示
 11. 新しいポストを作成
 12. ポストにいいね
 13. ポストを削除
  0. メインメニューに戻る
```

#### リプライ表示・管理メニュー
```
📋 リプライ表示・管理メニュー:
  1. ポストにリプライを行う
  2. リプライにリプライを行う
  3. リプライにいいね
  4. リプライを削除
  5. ポストとリプライのツリー構造を取得
  6. 個別のリプライを取得
  7. ユーザーのリプライ一覧を取得
  0. メインメニューに戻る
```

## サンプルデータ

デモでは以下のサンプルユーザーが利用可能です：

| ID | ユーザー名 | 表示名 | 説明 |
|----|-----------|--------|------|
| 1 | hero_user | 勇者 | 勇者としてログイン中 |
| 2 | mage_user | 魔法使い | 魔法研究者 |
| 3 | warrior_user | 戦士 | 剣術修行者 |
| 4 | thief_user | 盗賊 | 宝探し専門 |
| 5 | priest_user | 僧侶 | 癒し手 |
| 6 | merchant_user | 商人 | 交易業者 |

### 初期関係性
- 勇者（ID:1）は魔法使い（ID:2）と戦士（ID:3）をフォローしている
- 魔法使い（ID:2）は勇者（ID:1）をフォローしている
- 僧侶（ID:5）は全員からフォローされている

### サンプルポスト
各ユーザーが数件のポストを持っています：
- パブリックポスト（🌐）
- フォロワー限定ポスト（👥）
- プライベートポスト（🔒）

### サンプルリプライ
各ポストに対してリプライが作成されており、ネスト構造（最大4階層）を持っています：
- ポスト1: 勇者の冒険ポスト（2階層のリプライ）
- ポスト2: 魔法使いの研究ポスト（3階層のリプライ）
- ポスト5: 僧侶の癒しポスト（4階層のリプライ）- **深いツリー検証におすすめ**

## 使用例

### 1. 自分のプロフィール確認
```
メインメニュー > 1. ユーザー関係の表示・更新 > 1. 自分のプロフィール表示
```

### 2. 他のユーザーのタイムライン表示
```
メインメニュー > 2. ポストの表示 > 2. 他のユーザーのタイムライン表示
```
表示したいユーザーID（例: 2）を入力すると、そのユーザーの公開・フォロワー限定ポストが表示されます。

### 3. ホームタイムライン表示
```
メインメニュー > 2. ポストの表示 > 3. ホームタイムライン表示
```
フォロー中のユーザーのポストが新しい順に表示されます。

### 4. 新しいユーザー作成
```
メインメニュー > 1. ユーザー関係の表示・更新 > A. 新しいユーザーを作成
```
ユーザー名、表示名、自己紹介を入力して新しいユーザーを作成できます。

### 5. 新しいポスト作成
```
メインメニュー > 2. ポストの表示 > 11. 新しいポストを作成
```
内容と公開範囲（公開/フォロワー限定/プライベート）を設定してポストを作成できます。

### 6. リプライツリーの表示
```
メインメニュー > 3. リプライの表示・管理 > 5. ポストとリプライのツリー構造を取得
```
指定したポストのリプライをツリー構造で表示します。深い会話の流れを確認できます。

### 7. リプライに返信
```
メインメニュー > 3. リプライの表示・管理 > 2. リプライにリプライを行う
```
ツリー表示されたリプライから番号を選択して返信できます。

## 権限チェック機能

デモでは実際のSNSと同様に権限チェックが実装されています：

- **ブロックされたユーザーのポスト**: ブロックしているユーザーのポストは表示されません
- **非公開ポスト**: フォロワー限定のポストはフォロワー以外には表示されません
- **プライベートポスト**: 自分のプライベートポストのみ表示されます

## エラーハンドリング

デモでは適切なエラーハンドリングを実装しています：
- 存在しないユーザーIDを指定した場合
- 無効な数値入力
- 権限のない操作（自分自身をフォローしようとするなど）

## 技術仕様

- **アーキテクチャ**: DDD（Domain Driven Design）
- **言語**: Python 3.8+
- **主なコンポーネント**:
  - `UserQueryService`: ユーザー情報照会
  - `UserCommandService`: ユーザー情報更新
  - `PostQueryService`: ポスト情報照会
  - `PostCommandService`: ポスト情報更新
  - `ReplyQueryService`: リプライ情報照会
  - `ReplyCommandService`: リプライ情報更新
  - `InMemorySnsUserRepository`: ユーザー情報インメモリ永続化
  - `InMemoryPostRepository`: ポスト情報インメモリ永続化
  - `InMemoryReplyRepository`: リプライ情報インメモリ永続化

## 注意事項

- このデモはテストおよび動作確認を目的としたものです
- データはメモリ上にのみ保存され、再起動時に初期化されます
- 実際の運用環境では適切なデータベースを使用してください