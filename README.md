# AI RPG World

LLMがプレイできるテキストRPGのワールド管理システムです。階層的な場所管理と現実的な移動制限を備えています。

## 📁 ディレクトリ構造

```
ai_rpg_world/
├── src/                    # ソースコード
│   ├── models/            # データモデル
│   │   ├── agent.py       # エージェント（プレイヤー）クラス
│   │   ├── spot.py        # 場所（スポット）クラス
│   │   └── item.py        # アイテムクラス
│   ├── systems/           # システムロジック
│   │   ├── world.py       # ワールド管理クラス
│   │   └── message.py     # メッセージシステム
│   └── engine/            # ゲームエンジン
├── tests/                 # テストコード
│   ├── test_spot.py       # Spotクラスの機能テスト
│   ├── test_world.py      # Worldクラスのインタラクティブテスト
│   └── test_world_demo.py # Worldクラスの自動デモテスト
├── data/                  # ゲームデータ
└── README.md             # このファイル
```

## 🎮 主要機能

### 階層的移動システム

- **現実的な移動制限**: 2階の教室からは直接外に出ることができない
- **複数入口対応**: 建物に正面玄関、裏口などの複数の入口を設定可能
- **直感的なインターフェース**: 「外に出る」「〇〇に入る」のような自然な表現

### 場所（Spot）の管理

- **親子関係**: 建物とその内部の場所を階層的に管理
- **接続関係**: 同階層間の移動（東西南北、上下など）
- **入口管理**: 各建物への入口とそこから入った時の最初の場所を設定

### エージェント（Agent）の管理

- **位置追跡**: エージェントの現在地を管理
- **アイテム所持**: エージェントが持つアイテムの管理

## 🧪 テスト実行方法

プロジェクトルート（`llm_trpg_project/`）から以下のコマンドを実行してください。

### 1. Spotクラスの機能テスト

```bash
python -m tests.test_spot
```

**内容**: 
- 階層的移動システムのデモンストレーション
- 現実的な移動制限の確認
- 1年A組から八百屋への移動例

### 2. Worldクラスのインタラクティブテスト

```bash
python -m tests.test_world
```

**内容**:
- 標準入力でユーザーが移動を選択
- リアルタイムでエージェントの状況を表示
- 利用可能な行動の一覧表示

### 3. Worldクラスの自動デモテスト

```bash
python -m tests.test_world_demo
```

**内容**:
- 3つのシナリオの自動実行
- 移動制限の動作確認
- 複数入口システムのテスト

## 🏗️ 使用例

### 基本的な使用方法

```python
from src.models.spot import Spot
from src.models.agent import Agent
from src.systems.world import World

# ワールドを作成
world = World()

# 場所を作成
town_center = Spot("town_center", "街の中心部", "賑やかな街の中心部")
school = Spot("school", "桜丘学園", "大きな3階建ての学校")

# ワールドに追加
world.add_spot(town_center)
world.add_spot(school)

# エージェントを作成
agent = Agent("player_001", "プレイヤー")
agent.set_current_spot_id("town_center")
world.add_agent(agent)

# 移動を実行
success = world.execute_agent_movement("player_001", "北")
```

### 階層的な場所の設定

```python
# 学校内部の場所を作成
hall_1f = Spot("hall_1f", "1階廊下", "学校の1階廊下", parent_spot_id="school")
hall_1f.set_as_entrance("正面玄関")
hall_1f.set_exit_to_parent("town_center")

# 学校への入口を設定
school.add_entry_point("正面玄関", "hall_1f")
school.add_child_spot("hall_1f")

# 接続関係を設定
town_center.add_connection("北", "school")
```

## 🔧 システム設計の特徴

### 責務の分離

- **World**: Agent/Spotの管理とAgentの移動処理
- **Agent**: 自身の状態管理（現在地、所持アイテムなど）
- **Spot**: 場所固有の機能（利用可能な移動先の取得）

### 現実的な制約

- 物理的に不可能な移動を防止
- プレイヤーが論理的な経路を辿る必要
- 建物の出入口が限定される

### LLMフレンドリー

- 各ステップで詳細な状況情報を提供
- 移動の成功/失敗が明確
- 自然な言語での行動選択

## 📊 テスト結果例

```
🎮 RPG階層的移動システム自動検証デモ
============================================================
📋 シナリオ1: 1年A組から八百屋への移動

📍 ステップ 0
============================================================
🚶 エージェント: 山田太郎 (ID: agent_001)
📍 現在地: 1年A組 (ID: classroom_1a)
📝 説明: 1年A組の教室。窓から校庭が見える。
🏢 所属建物: 桜丘学園
============================================================

🚶‍♂️ 利用可能な行動:
----------------------------------------
  西 → 1階廊下

🚶 ステップ 1: 西 を実行
✅ 移動成功: 1年A組 → 1階廊下
```

## 🚀 今後の拡張予定

- アイテムシステムの充実
- NPCとの相互作用
- クエストシステム
- セーブ/ロード機能
- マルチプレイヤー対応

## 📝 開発ノート

このシステムは、LLMが自然に理解できるテキストRPGの実現を目指して設計されています。階層的な場所管理により、複雑な建物構造でも直感的に移動できるようになっています。 